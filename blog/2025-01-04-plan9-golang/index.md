---
slug: assembler
title: Plan9 & Golang
authors: [Agility6]
tags: [go]
---

åœ¨ä¸Šç¯‡æ–‡ç« è¯´åˆ°äº†å­¦ä¹ Plan 9åŸºç¡€å¯ä»¥ä¸ºæˆ‘ä»¬æ­å¼€åº•å±‚çš„ä¸€äº›ç»†èŠ‚ï¼Œä»è€Œé€šè¿‡å®è·µå»æ¢ç©¶åŸç†ã€‚æ¥ä¸‹æ¥å°±ä»¥Plan 9ä¸ºåŸºç¡€ï¼Œä»ä¸åŒè§’åº¦å»æ¢ç´¢Golangè¯­è¨€å§ã€‚

å¦‚æœä½ è¿˜æ²¡æœ‰é˜…è¯»Plan 9ç›¸å…³çš„çŸ¥è¯†ï¼Œæ¨èé˜…è¯»[Plan9 & Go Assembler](https://tinyfun.club/blog/assembler)

> ç¯å¢ƒè¯´æ˜ï¼šMac m1 ï¼ˆARMæ¶æ„ï¼‰ã€Golang v1.23.2

## ç®€å•å›é¡¾

è¿™é‡Œç®€å•å›é¡¾å‡ ä¸ªæ¯”è¾ƒé‡è¦çš„çŸ¥è¯†ç‚¹å§

- Plan 9æ±‡ç¼–ä¼ªå¯„å­˜å™¨

	- SBï¼ˆStatic base pointerï¼‰ç”¨äºè®¿é—®å…¨å±€ç¬¦å·ï¼Œæ¯”å¦‚å‡½æ•°ã€å…¨å±€å˜é‡
	- FPï¼ˆFrame pointerï¼‰ç”¨äºè®¿é—®å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼
	- PCï¼ˆProgram counterï¼‰ä¿å­˜CPUä¸‹ä¸€æ¡è¦è¿è¡Œçš„æŒ‡ä»¤
	- SPï¼ˆStack pointerï¼‰æŒ‡å‘å½“å‰æ ˆå¸§çš„æ ˆé¡¶

- Plan 9æºæ“ä½œæ•°ä¸ç›®æ ‡æ“ä½œæ•°æ–¹å‘ï¼Œæºæ“ä½œæ•°åœ¨å‰ï¼Œç›®çš„æ“ä½œæ•°åœ¨å

	- `movl $0x2, %eax` å°†ç«‹å³æ•°0x2ç§»åŠ¨åˆ°eaxå¯„å­˜å™¨


## å†æ¬¡çª¥æ¢å‡½æ•°

### å‡½æ•°åºè¨€

åœ¨å‡½æ•°è°ƒç”¨çš„æ—¶å€™ï¼Œä¼šç»å¸¸çœ‹åˆ°è¿™æ ·ä¸€æ®µçš„å‡½æ•°åºè¨€ï¼Œä¸»è¦çš„ä½œç”¨å°±æ˜¯ä¿å­˜ã€Œè°ƒç”¨è€…çš„ã€`BP`

```asm
pushq     %rbp
movq      %rsp,  %rbp
subq      %16,   %rsp
```

å¤§è‡´æ­¥éª¤å¦‚ä¸‹

1. åˆå§‹çŠ¶æ€ï¼šå‡½æ•°å°šæœªè¢«è°ƒç”¨

  æ­¤æ—¶å‡½æ•°åªåŒ…å«è¿”å›åœ°å€ï¼ˆå³è°ƒç”¨å‡½æ•°çš„ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ï¼‰

  ![image](img/01.png)

2. `pushq %rbp`

  å°†è°ƒç”¨è€…çš„æ ˆå¸§æŒ‡é’ˆï¼ˆ`%rbp`ï¼‰å‹å…¥æ ˆ
  ä¿å­˜ä¸Šä¸€ä¸ªæ ˆå¸§çš„åŸºåœ°å€ï¼Œç”¨äºå‡½æ•°è¿”å›æ—¶æ¢å¤è°ƒç”¨è€…çš„æ ˆå¸§

  ![image](img/02.png)

3. `moveq %rsp,  %rbp`

  å°†å½“å‰æ ˆæŒ‡é’ˆ%rspçš„å€¼èµ‹ç»™%rbp, å»ºç«‹å½“å‰å‡½æ•°çš„æ ˆå¸§åŸºåœ°å€
  æ ‡è®°å½“å‰å‡½æ•°çš„æ ˆå¸§èµ·ç‚¹

  ![image](img/03.png)

4. `subq $16, %rsp`

	å°†æ ˆæŒ‡é’ˆ%rspå‘ä¸‹ç§»åŠ¨16å­—èŠ‚ï¼Œä¸ºå±€éƒ¨å˜é‡åˆ†é…ç©ºé—´
	å®Œæˆå±€éƒ¨å˜é‡æ ˆç©ºé—´çš„åˆ†é…
	
	![image](img/04.png)


ä¸‹é¢å°±æ¥ç¼–å†™ä»£ç ï¼ŒéªŒè¯ä¸€ä¸‹å§

`go tool compile -S -N -l add_func.go`

```go
// base/prologue/add_func.go
package main  
  
func add(a, b int) int {  
    return a + b  
}  
  
func main() {  
    _ = add(1, 2)  
}

```

- `MOVD.WÂ  R30, -32(RSP)` ä¿å­˜è°ƒç”¨è€…çš„é“¾æ¥å¯„å­˜å™¨ï¼ˆR30ï¼‰åˆ°æ ˆä¸­ã€‚
- `MOVDÂ  Â  R29, -8(RSP)` ä¿å­˜å½“å‰å¸§æŒ‡é’ˆï¼ˆR29ï¼‰åˆ°æ ˆä¸­ã€‚
- `SUB Â  Â  $8, RSP, R29` æ›´æ–°æ ˆå¸§æŒ‡é’ˆR29ã€‚

```assembly
0x0000 00000         TEXT    main.add(SB), NOSPLIT|LEAF|ABIInternal, $32-16  
0x0000 00000         MOVD.W  R30, -32(RSP)  
0x0004 00004         MOVD    R29, -8(RSP)  
0x0008 00008         SUB     $8, RSP, R29
```

å†æ¥çœ‹çœ‹å‡½æ•°å°¾å£°çš„åˆ†æ

`ADD $24, RSP, R29` æ¢å¤æ ˆå¸§æŒ‡é’ˆ

- `ADD $32, RSP` é‡Šæ”¾æ ˆç©ºé—´
- `RET (R30)` è¿”å›è°ƒç”¨è€…ã€‚

```assembly
0x0024 00036         ADD     $24, RSP, R29
0x0028 00040         ADD     $32, RSP
0x002c 00044         RET     (R30)
```

> æ³¨æ„æ¶æ„å·®å¼‚ï¼ŒArmæ¶æ„ä¸­ä½¿ç”¨çš„æ˜¯`MOVD.W`ä¿å­˜å¯„å­˜å™¨åˆ°æ ˆä¸Š

### è°ƒç”¨è§„çº¦

å‡½æ•°çš„è°ƒç”¨è§„çº¦ç”¨äºè§„å®šå¦‚ä½•åœ¨ç¨‹åºä¸­è°ƒç”¨å‡½æ•°ï¼Œä¾‹å¦‚å‚æ•°çš„ä¼ é€’æ–¹å¼ã€è¿”å›å€¼çš„å¤„ç†å’Œå¯„å­˜å™¨çš„ä½¿ç”¨ç­‰[x86 calling conventions](https://en.wikipedia.org/wiki/X86_calling_conventions)

åœ¨è¿™é‡Œåªéœ€è¦æ˜ç™½ï¼ŒGoåœ¨1.17ä¹‹åä½¿ç”¨äº†åŸºäºå¯„å­˜å™¨çš„è°ƒç”¨è§„çº¦ã€‚å½“ç„¶å¯„å­˜å™¨ä¸æ˜¯æ— é™ä½¿ç”¨çš„ï¼Œå½“è¾¾åˆ°ä¸€å®šç¨‹åº¦å°±ä¼šä½¿ç”¨æ ˆä¼ é€’ã€‚

![image](img/05.png)

> ä¸åŒçš„æ¶æ„å¯¹äºå¯„å­˜å™¨çš„ä½¿ç”¨å¯èƒ½ä¼šä¸ä¸€æ ·ï½

## Plan9 & åŸºç¡€æ•°æ®ç»“æ„

### string

åˆ›å»ºä¸€ä¸ªç®€å•çš„å­—ç¬¦ä¸²ï¼Œæå–å‡ºå…³é”®çš„æ±‡ç¼–ä»£ç `var a = "hello"`

```go
// data/string/main.go
package main

func main() {
	var a = "hello"
	println(a)
}

```

- å°†`"hello"`å­—ç¬¦ä¸²åŠ è½½åˆ°å¯„å­˜å™¨`R0`ä¸­

- éšåå°†ç«‹å³æ•°5ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬ç¨‹åºå­—ç¬¦ä¸²çš„é•¿åº¦åŠ è½½åˆ°å¯„å­˜å™¨`R0`ä¸­

- `R0, main.a-16(SP)`å’Œ`R0, main.a-8(SP)`ä¹Ÿå°±æ˜¯å®ƒä»¬ç›¸éš”çš„ä½ç½®ï¼Œå¦‚å›¾æ‰€ç¤º

  ![image](img/06.png)

```assembly
	0x0018 00024 	MOVD	$go:string."hello"(SB), R0 # è¿™é‡Œä»…ä»…æ˜¯åœ°å€
	0x0020 00032 	MOVD	R0, main.a-16(SP)
	0x0024 00036 	MOVD	$5, R0
	0x0028 00040 	MOVD	R0, main.a-8(SP)
```

é€šè¿‡æ±‡ç¼–ä¹Ÿå¯ä»¥çœ‹åˆ°Goä¸­çš„å­—ç¬¦ä¸²ç»“æ„æ˜¯å¾ˆç®€å•çš„

```go
type stringStruct struct {
	str unsafe.Pointer
	len int
}
```

#### stirngä½œä¸ºå‚æ•°ä¼ é€’

å¦‚æœé—®ä½ åœ¨Goä¸­å­—ç¬¦ä¸²æ˜¯å¦‚ä½•è¿›è¡Œå‚æ•°ä¼ é€’çš„å‘¢ï¼Ÿè¿™ä¸ªæ—¶å€™åªéœ€è¦å†™ä¸€ä¸ªç®€å•çš„æµ‹è¯•doneï¼Œå…³æ³¨**é‡ç‚¹**çš„æ±‡ç¼–éƒ¨åˆ†å°±å¯ä»¥è§£ç­”äº†

```go
// data/string/string_param.go
package main

func foo(str string) {
	println("foo => " + str)
	str = "hello-golang"
	println("foo => " + str)
}

func main() {
	var a = "hello"
	println("main => " + a)
	foo(a)
	println("main => " + a)
}
```

ååˆ†æ¸…æ¥šçš„å¯ä»¥çœ‹åˆ°ï¼Œå°†`main.a-48(SP)`å’Œ`main.a-40(SP)`ï¼ˆå°±æ˜¯å‰é¢åˆ†æçš„å­—ç¬¦ä¸²çš„å€¼å’Œé•¿åº¦ï¼‰åˆ†åˆ«æ‹·è´åˆ°`R0`å’Œ`R1`å¯„å­˜å™¨ä¸­ï¼›æœ€åè°ƒç”¨`foo`å‡½æ•°ã€‚

å› æ­¤å¯ä»¥è¯´æ˜**`string`ä½œä¸ºå‚æ•°ä¼ é€’æ˜¯ä¼šæ‹·è´ä¸€ä»½çš„ï¼Œä½†æ˜¯æ³¨æ„åº•å±‚æ•°ç»„æ˜¯ä¸æ˜¯æ‹·è´çš„**

```assembly
	0x0064 00100 	MOVD	main.a-48(SP), R0
	0x0068 00104 	MOVD	main.a-40(SP), R1
	0x006c 00108 	CALL	main.foo(SB)
```

### Array

æ—¥å¸¸åœ¨Golangå¼€å‘ä¸­Arrayä½¿ç”¨çš„å…¶å®å¹¶ä¸å¤šï¼Œæ›´å¤šä½œä¸ºä¸€ä¸ªåº•å±‚çš„å®ç°ã€‚arrayçš„ç»“æ„æ˜¯ä¸éœ€è¦é•¿åº¦è¿™ä¸ªå­—æ®µçš„ï¼Œå› ä¸ºå®ƒæ˜¯å®šé•¿çš„ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒåœ¨ç¼–è¯‘æœŸå°±èƒ½å¤Ÿç¡®å®šé•¿åº¦æ˜¯ä¸€ä¸ªè¿ç»­çš„å†…å­˜åŒºåŸŸã€‚

é‚£ä¹ˆå°±æ¥éªŒè¯ä¸€ä¸‹æ˜¯ä¸æ˜¯çœŸçš„å¦‚ä¸Šæ‰€è¯´

```go
// data/array/main.go
package main

func main() {
	array := [5]int{10, 1, 2, 4, 5}
	_ = array
}

```

- **LDP**ï¼šæ˜¯ ARM æ¶æ„çš„ â€œLoad Pairâ€ æŒ‡ä»¤ï¼Œè¡¨ç¤ºåŠ è½½ä¸¤ä¸ªè¿ç»­çš„å€¼ï¼Œåˆ°å¯„å­˜å™¨å¯¹ (R0, R1) ä¸­ã€‚
- æ€»ç»“ä¸€ä¸‹è¿™é‡Œçš„æ“ä½œéƒ½æ˜¯åœ¨è·å–å€¼å¹¶ä¸”å­˜å…¥åˆ°å¯„å­˜å™¨ä¸­ï¼Œå¹¶æ²¡æœ‰å‘stringåˆå§‹åŒ–åˆ°æ—¶å€™çœ‹åˆ°æœ‰å…³é•¿åº¦çš„ä¿¡æ¯

```assembly
	0x000c 00012 	LDP	main..stmp_0(SB), (R0, R1)
	0x0018 00024 	PCDATA	$0, $-4
	0x0018 00024 	LDP	main..stmp_0+16(SB), (R2, R3)
	0x0024 00036 	PCDATA	$0, $-1
	0x0024 00036 	STP	(R0, R1), main.array-40(SP)
	0x0028 00040 	STP	(R2, R3), main.array-24(SP)
	0x002c 00044 	MOVD	$5, R0
	0x0030 00048 	MOVD	R0, main.array-8(SP)
```

#### é»˜è®¤å€¼

ç›¸ä¿¡ä½ ä¸€å®šçŸ¥é“ï¼Œåœ¨å®šä¹‰arrayçš„æ—¶å€™å¦‚æœæ˜¯æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œé‚£ä¹ˆé»˜è®¤å€¼å°±æ˜¯`0`ï¼Œåœ¨æ±‡ç¼–å±‚é¢ä¸Šå¤„ç†é»˜è®¤å€¼ï¼Œä¹Ÿæ˜¯ä¼šæ ¹æ®ä¸åŒçš„å®šé•¿ï¼Œé€‰æ‹©å¯¹åº”çš„æ–¹æ³•ã€‚

```go
array := [2]int // åœ¨æ±‡ç¼–ä¸­é»˜è®¤ç›´æ¥ä½¿ç”¨STP	(ZR, ZR), main.array-16(SP)è¿›è¡Œ0å€¼çš„åˆå§‹åŒ–

array1 := [10]int // ä½¿ç”¨runtime.duffzeroè¿›è¡Œåˆå§‹åŒ–
```

>  duffzeroä¹Ÿæ˜¯æ±‡ç¼–ä»£ç 

Go ç¼–è¯‘å™¨ä¼šæ’å…¥æ‰€è°“çš„ duffzero å‡½æ•°è°ƒç”¨ï¼Œä»¥æ­¤æ¥æé«˜æ¸…é›¶çš„æ•ˆç‡[è¾¾å¤«è®¾å¤‡(Duff's device)](https://en.wikipedia.org/wiki/Duff%27s_device)

### Slice

ç›¸æ¯”äºarrayï¼Œsliceå¯è°“æ˜¯å¼€å‘ä½¿ç”¨é¢‘ç‡æœ€é«˜çš„ã€‚ä¸åŒäºæ•°ç»„å•å•æ˜¯ä¸€å—è¿ç»­å†…å­˜ï¼›sliceæ”¯æŒåŠ¨æ€æ‰©å®¹ï¼Œæ‰€ä»¥åœ¨åº•å±‚çš„æ•°æ®ç»“æ„ä¸­å°±ä¼šæœ‰æ‰€å˜åŒ–ã€‚

1. æŒ‡å‘åº•å±‚æ•°æ®çš„æŒ‡é’ˆ
2. åˆ‡ç‰‡é•¿åº¦
3. åˆ‡ç‰‡å®¹é‡

```go
type slice struct {
	array unsafe.Pointer
	len   int
	cap   int
}
```

æŒ‰ç…§æƒ¯ä¾‹çœ‹çœ‹æ±‡ç¼–ä¸­sliceæ˜¯å¦‚ä½•çš„

```go
// data/slice/main.go
package main

func main() {
	slice := []int{1, 2, 3, 4, 5}
	_ = slice
}

```

å¤§è‡´æ€»ç»“ä¸€ä¸‹æ­¥éª¤

1. æ ˆç©ºé—´åˆå§‹åŒ–

2. å‘åˆ‡ç‰‡èµ‹å€¼

   1. å–åœ°å€

   2. è®¾ç½®å€¼
	 
   3. å†™å…¥å¯¹åº”åç§»é‡

3. æ„é€ åˆ‡ç‰‡ç»“æ„ï¼ˆæŒ‡é’ˆã€é•¿åº¦ã€å®¹é‡ï¼‰

4. å®Œæˆåˆ‡ç‰‡åˆå§‹åŒ–

```assembly
	# æ ˆç©ºé—´åˆå§‹åŒ–
	0x000c 00012 	STP	(ZR, ZR), main..autotmp_2-72(SP)
	0x0010 00016 	STP	(ZR, ZR), main..autotmp_2-56(SP)
	0x0014 00020 	MOVD	ZR, main..autotmp_2-40(SP)
	
	0x0018 00024 	MOVD	$main..autotmp_2-72(SP), R0
	0x001c 00028 	MOVD	R0, main..autotmp_1-32(SP)
	0x0020 00032 	PCDATA	$0, $-2
	0x0020 00032 	MOVB	(R0), R27
	0x0024 00036 	PCDATA	$0, $-1
	
	# å¸¸é‡1
	0x0024 00036 	MOVD	$1, R1
	0x0028 00040 	MOVD	R1, (R0)
	
	0x002c 00044 	PCDATA	$0, $-2
	0x002c 00044 	MOVB	(R0), R27
	0x0030 00048 	PCDATA	$0, $-1
	
	# å¸¸é‡2
	0x0030 00048 	MOVD	$2, R1
	0x0034 00052 	MOVD	R1, 8(R0)
	
	0x0038 00056 	PCDATA	$0, $-2
	0x0038 00056 	MOVB	(R0), R27
	0x003c 00060 	PCDATA	$0, $-1
	
	# å¸¸é‡3
	0x003c 00060 	MOVD	$3, R1
	0x0040 00064 	MOVD	R1, 16(R0)
	
	0x0044 00068 	PCDATA	$0, $-2
	0x0044 00068 	MOVB	(R0), R27
	0x0048 00072 	PCDATA	$0, $-1
	
	# å¸¸é‡4
	0x0048 00072 	MOVD	$4, R1
	0x004c 00076 	MOVD	R1, 24(R0)
	
	0x0050 00080 	MOVD	main..autotmp_1-32(SP), R0
	0x0054 00084 	PCDATA	$0, $-2
	0x0054 00084 	MOVB	(R0), R27
	0x0058 00088 	PCDATA	$0, $-1
	
	# å¸¸é‡5
	0x0058 00088 	MOVD	$5, R1
	0x005c 00092 	MOVD	R1, 32(R0)
	0x0060 00096 	MOVD	main..autotmp_1-32(SP), R0
	0x0064 00100 	PCDATA	$0, $-2
	0x0064 00100 	MOVB	(R0), R27
	0x0068 00104 	PCDATA	$0, $-1
	0x0068 00104 	JMP	108
	
	# æ„é€ åˆ‡ç‰‡ç»“æ„ï¼ˆæŒ‡é’ˆã€é•¿åº¦ã€å®¹é‡ï¼‰
	0x006c 00108 	MOVD	R0, main.slice-24(SP) # æŒ‡å‘åº•å±‚æ•°ç»„çš„åœ°å€ï¼ˆR0ï¼‰
	0x0070 00112 	MOVD	R1, main.slice-16(SP) # é•¿åº¦
	0x0074 00116 	MOVD	R1, main.slice-8(SP)	# å®¹é‡

```

## è§£å¼€é­”æ³• ğŸª„

æœ€åå†æ¥è°ˆè°ˆï¼ŒæŒæ¡åŸºç¡€çš„æ±‡ç¼–èƒ½ç»™æˆ‘ä»¬å¸¦æ¥ä»€ä¹ˆï¼›ä¸çŸ¥é“ä½ åœ¨é˜…è¯»çš„æ—¶å€™ï¼Œä¼šä¸ä¼šç–‘æƒ‘ä¸€äº›æ¦‚å¿µçš„çœŸä¼ªæ€§æˆ–è€…è¯´æƒ³å»æ±‚è¯å®ƒã€‚

è¿™ä¸ªæ—¶å€™å½“ç„¶æ˜¯å¯ä»¥é€šè¿‡ä»£ç doneçš„æ–¹å¼å»éªŒè¯ï¼›æˆ–è€…æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨æ±‡ç¼–çš„æ–¹å¼å»è¿›è¡Œæ±‚è¯ï¼Œä»¥ä¸‹æ¡ˆä¾‹æ˜¯æˆ‘åœ¨é˜…è¯»ã€ŠGoè¯­è¨€é«˜çº§ç¼–ç¨‹ã€‹æ‰€ç–‘æƒ‘çš„

### æ¡ˆä¾‹ä¸€

![image](img/07.png)

- ä»£ç æ–¹å¼è¿›è¡ŒéªŒè¯

```go
package main

import "fmt"

func main() {
	array := [...]int{1, 2, 3}
	array2 := array
	array2[0] = 100
	fmt.Println(array)
	fmt.Println(array2)
}
```

- é€šè¿‡æ±‡ç¼–çš„æ–¹å¼ï¼Œæˆ‘ä»¬åªéœ€è¦å…³æ³¨`array2:=array`çš„æ±‡ç¼–ä»£ç 
  - å¾ˆç®€å•å…¶å®å°±æ˜¯ï¼Œè¿™äº›æŒ‡ä»¤å°†å¯„å­˜å™¨ä¸­çš„æ•°æ®ï¼ˆå¦‚ R0, R1, R2ï¼‰åˆ†åˆ«å­˜å‚¨åˆ°æ ˆä¸Šçš„ä¸åŒä½ç½®ï¼Œé€šå¸¸åœ¨å¤„ç†æ•°ç»„æˆ–åˆ‡ç‰‡æ—¶ï¼Œå¯èƒ½æ˜¯å°†æ•°ç»„æˆ–åˆ‡ç‰‡çš„å¤šä¸ªå…ƒç´ ï¼ˆæˆ–å…¶å®ƒç»“æ„ï¼‰å­˜å…¥æ ˆç©ºé—´ã€‚

```assembly
	0x002c 00044 	MOVD	R0, main.array2-48(SP)
	0x0030 00048 	MOVD	R1, main.array2-40(SP)
	0x0034 00052 	MOVD	R2, main.array2-32(SP)
```

é‚£ä¹ˆå†æ¥å¯¹æ¯”ä¸€ä¸‹`array2:=&array`å§

1. `MOVD $main.array-32(SP), R0`å°†`array`çš„ã€Œåœ°å€ã€å­˜å‚¨åˆ°å¯„å­˜å™¨`R0`ä¸­ã€‚
2. `R0`çš„å€¼ä¿å­˜åˆ°`main.array2`åˆ°æ ˆä½ç½®ï¼ˆä¹Ÿå°±æ˜¯è¯´array2 åªæ˜¯å­˜å‚¨äº† array çš„åœ°å€ï¼Œå®ƒæŒ‡å‘çš„æ˜¯åŒä¸€å—å†…å­˜ç©ºé—´ï¼‰

```assembly
	0x0024 00036 	MOVD	$main.array-32(SP), R0
	0x0028 00040 	MOVD	R0, main.array2-8(SP)
	0x002c 00044 	PCDATA	$0, $-2
```

### æ¡ˆä¾‹äºŒ

![image](img/08.png)

```go
package main

func main() {
	array := [0]int{}
	_ = array
}

```

ä¸éš¾å‘ç°ï¼Œå¯¹äºé›¶é•¿åº¦çš„æ•°ç»„ï¼ŒGo ç¼–è¯‘å™¨é€šå¸¸ä¼šä¼˜åŒ–æ‰æ•°ç»„çš„å®é™…åˆ†é…ï¼Œå› æ­¤åœ¨æ±‡ç¼–ä»£ç ä¸­çœ‹ä¸åˆ°è¯¥æ•°ç»„çš„ç›¸å…³å†…å®¹ã€‚

```assembly
main.main STEXT size=16 args=0x0 locals=0x0 funcid=0x0 align=0x0 leaf
	0x0000 00000 	TEXT	main.main(SB), LEAF|NOFRAME|ABIInternal, $0-0
	0x0000 00000 	FUNCDATA	$0, gclocalsÂ·g2BeySu+wFnoycgXfElmcg==(SB)
	0x0000 00000 	FUNCDATA	$1, gclocalsÂ·g2BeySu+wFnoycgXfElmcg==(SB)
	0x0000 00000 	RET	(R30)
	0x0000 c0 03 5f d6 00 00 00 00 00 00 00 00 00 00 00 00  .._.............
```

## æœ€å

é€šè¿‡æ±‡ç¼–çš„æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥æ›´åŠ æ·±å…¥çš„äº†è§£Goè¯­è¨€çš„åº•å±‚å®ç°ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æ±‡ç¼–çš„æ–¹å¼å»éªŒè¯ä¸€äº›ç–‘æƒ‘çš„é—®é¢˜ã€‚å½“ç„¶ï¼Œè¿™é‡Œåªæ˜¯ç®€å•çš„ä»‹ç»ç®—æ˜¯è¿›è¡ŒæŠ›ç –å¼•ç‰ã€‚

åç»­å¯ä»¥å…³æ³¨æ­¤[repo](https://github.com/AnnularLabs/plan9-golang)ï¼Œä¼šä¸å®šæœŸæ›´æ–°ä¸€äº›æœ‰è¶£çš„æ¡ˆä¾‹ï¼Œä¹Ÿæ¬¢è¿å¤§å®¶ä¸€èµ·æ¢è®¨ï½

## å‚è€ƒ

https://xargin.com/go1-17-new-calling-convention/

https://en.wikipedia.org/wiki/X86_calling_conventions

https://taoshu.in/go/duff-zero.html
